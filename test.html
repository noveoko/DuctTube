<!DOCTYPE html>
<html>
<head>
    <title>Ollama Backend Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        input, textarea, button {
            padding: 10px;
        }
        button {
            cursor: pointer;
            background-color: #0078d7;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            margin-top: 20px;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 4px;
            min-height: 100px;
        }
        .status {
            margin-top: 10px;
            font-weight: bold;
        }
        .error {
            color: red;
        }
        .success {
            color: green;
        }
        .loading {
            color: orange;
        }
        .comparison {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        .title-pair {
            display: flex;
            border: 1px solid #eee;
            padding: 10px;
        }
        .title-pair div {
            flex: 1;
            padding: 10px;
        }
        .original {
            border-right: 1px solid #eee;
            background-color: #f9f9f9;
        }
        .factual {
            background-color: #f0f8ff;
        }
    </style>
</head>
<body>
    <h1>Ollama Backend Test</h1>
    
    <div class="container">
        <div class="input-group">
            <label for="endpoint">Backend Endpoint:</label>
            <input type="text" id="endpoint" value="http://localhost:8000" />
        </div>
        
        <div class="input-group">
            <label for="healthCheck">Check Backend Status:</label>
            <button id="healthCheck">Test Connection</button>
            <div id="healthStatus" class="status"></div>
        </div>
        
        <div class="input-group">
            <label for="models">Available Models:</label>
            <button id="listModels">List Models</button>
            <select id="modelSelect" style="margin-top: 10px; padding: 5px;">
                <option value="llama3:8b">llama3:8b (default)</option>
            </select>
        </div>
        
        <div class="input-group">
            <label for="titleInput">Test Title:</label>
            <textarea id="titleInput" rows="3">YOU WON'T BELIEVE WHAT HAPPENED NEXT! This SECRET TRICK the government doesn't want you to know!!!</textarea>
        </div>
        
        <button id="processTitle">Process Title</button>
        
        <div id="result" class="result">
            <p><em>Results will appear here...</em></p>
        </div>
        
        <h2>Batch Test</h2>
        <p>Test multiple clickbait titles at once:</p>
        <button id="batchTest">Run Batch Test</button>
        
        <div id="batchResult" class="comparison"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const healthCheck = document.getElementById('healthCheck');
            const listModels = document.getElementById('listModels');
            const processTitle = document.getElementById('processTitle');
            const batchTest = document.getElementById('batchTest');
            
            healthCheck.addEventListener('click', async function() {
                const endpoint = document.getElementById('endpoint').value;
                const healthStatus = document.getElementById('healthStatus');
                
                healthStatus.textContent = 'Checking connection...';
                healthStatus.className = 'status loading';
                
                try {
                    const response = await fetch(`${endpoint}/health`);
                    const data = await response.json();
                    
                    if (data.status === 'healthy' && data.ollama.status === 'available') {
                        healthStatus.textContent = `Connected successfully! Ollama v${data.ollama.version} available.`;
                        healthStatus.className = 'status success';
                    } else {
                        healthStatus.textContent = 'Backend connected but Ollama is not available.';
                        healthStatus.className = 'status error';
                    }
                } catch (error) {
                    healthStatus.textContent = `Connection failed: ${error.message}`;
                    healthStatus.className = 'status error';
                }
            });
            
            listModels.addEventListener('click', async function() {
                const endpoint = document.getElementById('endpoint').value;
                const modelSelect = document.getElementById('modelSelect');
                const healthStatus = document.getElementById('healthStatus');
                
                healthStatus.textContent = 'Fetching models...';
                healthStatus.className = 'status loading';
                
                try {
                    const response = await fetch(`${endpoint}/models`);
                    const data = await response.json();
                    
                    modelSelect.innerHTML = '';
                    
                    if (data.models && data.models.length > 0) {
                        data.models.forEach(model => {
                            const option = document.createElement('option');
                            option.value = model;
                            option.textContent = model;
                            modelSelect.appendChild(option);
                        });
                        
                        healthStatus.textContent = `Loaded ${data.models.length} models.`;
                        healthStatus.className = 'status success';
                    } else {
                        const option = document.createElement('option');
                        option.value = 'llama3:8b';
                        option.textContent = 'llama3:8b (default)';
                        modelSelect.appendChild(option);
                        
                        healthStatus.textContent = 'No models found. Using default.';
                        healthStatus.className = 'status error';
                    }
                } catch (error) {
                    healthStatus.textContent = `Failed to fetch models: ${error.message}`;
                    healthStatus.className = 'status error';
                }
            });
            
            processTitle.addEventListener('click', async function() {
                const endpoint = document.getElementById('endpoint').value;
                const model = document.getElementById('modelSelect').value;
                const title = document.getElementById('titleInput').value;
                const result = document.getElementById('result');
                
                result.innerHTML = '<p><em>Processing...</em></p>';
                
                try {
                    const response = await fetch(`${endpoint}/fix-title`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            title: title,
                            model: model
                        }),
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    result.innerHTML = `
                        <p><strong>Original:</strong> ${data.original}</p>
                        <p><strong>Factual:</strong> ${data.factual}</p>
                        <p><strong>Processing Time:</strong> ${data.processing_time.toFixed(2)} seconds</p>
                        <p><strong>Model:</strong> ${model}</p>
                    `;
                } catch (error) {
                    result.innerHTML = `<p class="error">Error: ${error.message}</p>`;
                }
            });
            
            batchTest.addEventListener('click', async function() {
                const endpoint = document.getElementById('endpoint').value;
                const model = document.getElementById('modelSelect').value;
                const batchResult = document.getElementById('batchResult');
                
                const clickbaitTitles = [
                    "YOU WON'T BELIEVE WHAT HAPPENED NEXT!!!",
                    "DOCTORS HATE HIM - Local Man Discovers ONE WEIRD TRICK To Lose Weight Fast!!",
                    "I Can't Believe My Eyes When I Saw This... SHOCKING REVELATION!",
                    "This Is The Most INCREDIBLE Thing You'll See Today... I'm Speechless!",
                    "TOP 10 SECRETS The Government Is HIDING From YOU!!!",
                    "WATCH THIS Before It Gets DELETED... They Don't Want This Getting Out!"
                ];
                
                batchResult.innerHTML = '<p><em>Processing batch, please wait...</em></p>';
                
                try {
                    const results = [];
                    
                    for (const title of clickbaitTitles) {
                        const response = await fetch(`${endpoint}/fix-title`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                title: title,
                                model: model
                            }),
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP error ${response.status}`);
                        }
                        
                        const data = await response.json();
                        results.push(data);
                    }
                    
                    batchResult.innerHTML = '';
                    
                    results.forEach(result => {
                        const pair = document.createElement('div');
                        pair.className = 'title-pair';
                        
                        const original = document.createElement('div');
                        original.className = 'original';
                        original.textContent = result.original;
                        
                        const factual = document.createElement('div');
                        factual.className = 'factual';
                        factual.textContent = result.factual;
                        
                        pair.appendChild(original);
                        pair.appendChild(factual);
                        batchResult.appendChild(pair);
                    });
                } catch (error) {
                    batchResult.innerHTML = `<p class="error">Error: ${error.message}</p>`;
                }
            });
        });
    </script>
</body>
</html>